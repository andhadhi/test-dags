{
  "name": "etl-pipeline-s3",
  "operator": "kubernetes",
  "description": "ETL pipeline that reads/writes to S3 (LocalStack)",
  "params": {},
  "tasks": [
    {
      "name": "extract",
      "depends_on": [],
      "container": {
        "image": "node:22-alpine",
        "command": ["cd /repo && npm install && node tasks/extract.js"],
        "env": [
          { "name": "AWS_ENDPOINT_URL", "value": "http://localstack:4566" },
          { "name": "AWS_ACCESS_KEY_ID", "value": "test" },
          { "name": "AWS_SECRET_ACCESS_KEY", "value": "test" },
          { "name": "AWS_DEFAULT_REGION", "value": "us-east-1" },
          { "name": "S3_BUCKET", "value": "dag-demo" },
          { "name": "DATA_SOURCE", "value": "demo-api" }
        ],
        "resources": {
          "cpu": { "min": "100m", "max": "500m" },
          "mem": { "min": "128Mi", "max": "256Mi" }
        }
      }
    },
    {
      "name": "transform",
      "depends_on": ["extract"],
      "container": {
        "image": "node:22-alpine",
        "command": ["cd /repo && npm install && node tasks/transform.js"],
        "env": [
          { "name": "AWS_ENDPOINT_URL", "value": "http://localstack:4566" },
          { "name": "AWS_ACCESS_KEY_ID", "value": "test" },
          { "name": "AWS_SECRET_ACCESS_KEY", "value": "test" },
          { "name": "AWS_DEFAULT_REGION", "value": "us-east-1" },
          { "name": "S3_BUCKET", "value": "dag-demo" }
        ],
        "resources": {
          "cpu": { "min": "200m", "max": "1000m" },
          "mem": { "min": "256Mi", "max": "512Mi" }
        }
      }
    },
    {
      "name": "load",
      "depends_on": ["transform"],
      "container": {
        "image": "node:22-alpine",
        "command": ["cd /repo && npm install && node tasks/load.js"],
        "env": [
          { "name": "AWS_ENDPOINT_URL", "value": "http://localstack:4566" },
          { "name": "AWS_ACCESS_KEY_ID", "value": "test" },
          { "name": "AWS_SECRET_ACCESS_KEY", "value": "test" },
          { "name": "AWS_DEFAULT_REGION", "value": "us-east-1" },
          { "name": "S3_BUCKET", "value": "dag-demo" }
        ],
        "resources": {
          "cpu": { "min": "100m", "max": "500m" },
          "mem": { "min": "128Mi", "max": "256Mi" }
        }
      }
    }
  ]
}
